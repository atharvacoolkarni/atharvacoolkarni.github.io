<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Hourly Delay Analysis</title>
    <style>
        :root {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --accent-primary: #667eea;
            --accent-secondary: #764ba2;
            --border-color: #e9ecef;
            --shadow: rgba(0,0,0,0.1);
            --arrival-color: #dc3545;
            --departure-color: #17a2b8;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
            --shadow: rgba(255,255,255,0.1);
            --arrival-color: #ff6b7a;
            --departure-color: #4fc3f7;
        }

        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--border-color) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 1400px; /* Increased from 100% */
            width: 95%; /* Increased from default */
            margin: 0 auto;
            background-color: var(--bg-secondary);
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .header {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .header h2 {
            margin: 0 0 10px 0;
            font-size: 24px;
            font-weight: 600;
        }
        
        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 14px;
        }
        
        .controls-container {
            background-color: var(--bg-primary);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .toggle-container {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .toggle-buttons, .filter-buttons {
            display: inline-flex;
            background-color: var(--bg-secondary);
            border-radius: 25px;
            padding: 6px;
            box-shadow: 0 4px 15px var(--shadow);
        }
        
        .toggle-btn, .filter-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
            margin: 0 3px;
            color: var(--text-secondary);
        }
        
        .toggle-btn.active, .filter-btn.active {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transform: translateY(-1px);
        }
        
        .toggle-btn:hover:not(.active), .filter-btn:hover:not(.active) {
            background-color: var(--border-color);
            transform: translateY(-1px);
        }

        .filter-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-right: 10px;
        }
        
        .plot-container {
            padding: 30px;
            position: relative;
            height: auto;
        }
        
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 500px; /* Increased from 450px */
            background: var(--bg-secondary);
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow);
            overflow: hidden;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .info-text {
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
            padding: 15px;
            font-weight: 500;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .legend-item.hidden {
            opacity: 0.4;
            text-decoration: line-through;
        }
        
        .tooltip {
            position: absolute;
            background: var(--text-primary);
            color: var(--bg-secondary);
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
            white-space: nowrap;
        }
        
        /* Mobile Optimization */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 10px;
                width: 98%;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .theme-toggle {
                position: static;
                margin: 10px 0 0 0;
            }
            
            .header h2 {
                font-size: 20px;
            }
            
            .controls-container {
                padding: 15px;
                gap: 15px;
            }
            
            .toggle-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .toggle-btn, .filter-btn {
                padding: 10px 20px;
                font-size: 13px;
            }
            
            .plot-container {
                padding: 20px 15px;
            }
            
            .chart-wrapper {
                height: 400px;
            }
            
            .legend {
                gap: 15px;
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                width: 100%;
                margin: 0;
                border-radius: 0;
            }
            
            .chart-wrapper {
                height: 350px;
            }
            
            .toggle-buttons, .filter-buttons {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>
            <h2>Hourly Flight Delay Analysis</h2>
            <p>Interactive comparison between Python and R analysis results</p>
        </div>
        
        <div class="controls-container">
            <div class="toggle-container">
                <div class="toggle-buttons">
                    <button class="toggle-btn active" id="pythonBtn" onclick="showPythonData()">
                        üêç Python Analysis
                    </button>
                    <button class="toggle-btn" id="rBtn" onclick="showRData()">
                        üìä R Analysis
                    </button>
                </div>
            </div>
            
            <div class="toggle-container">
                <span class="filter-label">Show:</span>
                <div class="filter-buttons">
                    <button class="filter-btn active" id="bothBtn" onclick="setFilter('both')">
                        üìä Both
                    </button>
                    <button class="filter-btn" id="arrivalBtn" onclick="setFilter('arrival')">
                        üî¥ Arrival Only
                    </button>
                    <button class="filter-btn" id="departureBtn" onclick="setFilter('departure')">
                        üîµ Departure Only
                    </button>
                </div>
            </div>
        </div>
        
        <div class="plot-container">
            <div class="chart-wrapper">
                <canvas id="chartCanvas" class="chart-canvas"></canvas>
                <div class="tooltip" id="tooltip"></div>
            </div>
            <div class="legend">
                <div class="legend-item" id="arrivalLegend">
                    <div class="legend-color" style="background-color: var(--arrival-color);"></div>
                    <span>Arrival Delay</span>
                </div>
                <div class="legend-item" id="departureLegend">
                    <div class="legend-color" style="background-color: var(--departure-color);"></div>
                    <span>Departure Delay</span>
                </div>
            </div>
            <div class="info-text" id="infoText">
                Currently showing: Python analysis results (Both delays)
            </div>
        </div>
    </div>

    <script>
        let currentView = 'python';
        let currentFilter = 'both'; // 'both', 'arrival', 'departure'
        let canvas, ctx, tooltip;
        let hoveredBar = null;
        let isDarkMode = false;
        
        // Data for both Python and R analysis
        const hourLabels = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23'];
        
        const pythonData = {
            arrivalDelay: [10.21,8.75,8.91,7.51,-1.20,1.10,1.19,-0.32,0.51,1.12,1.67,2.26,2.89,3.63,4.49,6.14,8.53,9.41,11.79,12.25,13.60,13.15,13.13,11.53],
            departureDelay: [5.27,3.24,3.43,8.66,8.54,1.55,1.01,2.05,3.23,3.87,4.99,5.76,6.48,7.78,9.33,10.47,11.60,13.80,14.34,15.00,14.96,14.30,11.20,8.94]
        };
        
        const rData = {
            arrivalDelay: [9.85,8.42,8.73,7.28,-1.45,0.95,1.05,-0.48,0.38,0.97,1.52,2.11,2.74,3.48,4.31,5.96,8.21,9.18,11.52,12.01,13.32,12.89,12.85,11.28],
            departureDelay: [5.12,3.08,3.28,8.41,8.31,1.38,0.87,1.92,3.09,3.71,4.82,5.61,6.32,7.61,9.15,10.28,11.42,13.58,14.12,14.78,14.73,14.08,11.03,8.76]
        };

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
            
            const button = document.querySelector('.theme-toggle');
            button.textContent = isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            
            // Redraw chart with new colors
            drawChart(currentView === 'python' ? pythonData : rData);
        }

        function setFilter(filter) {
            currentFilter = filter;
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(filter + 'Btn').classList.add('active');
            
            // Update legend visibility
            const arrivalLegend = document.getElementById('arrivalLegend');
            const departureLegend = document.getElementById('departureLegend');
            
            arrivalLegend.classList.toggle('hidden', filter === 'departure');
            departureLegend.classList.toggle('hidden', filter === 'arrival');
            
            // Update info text
            const filterText = filter === 'both' ? 'Both delays' : 
                              filter === 'arrival' ? 'Arrival delays only' : 'Departure delays only';
            document.getElementById('infoText').textContent = 
                `Currently showing: ${currentView === 'python' ? 'Python' : 'R'} analysis results (${filterText})`;
            
            // Redraw chart
            drawChart(currentView === 'python' ? pythonData : rData);
        }
        
        function setupCanvas() {
            canvas = document.getElementById('chartCanvas');
            ctx = canvas.getContext('2d');
            tooltip = document.getElementById('tooltip');
            
            // Set canvas size based on container
            const container = canvas.parentElement;
            const dpr = window.devicePixelRatio || 1;
            canvas.width = container.offsetWidth * dpr;
            canvas.height = container.offsetHeight * dpr;
            canvas.style.width = container.offsetWidth + 'px';
            canvas.style.height = container.offsetHeight + 'px';
            ctx.scale(dpr, dpr);
            
            // Add mouse event listeners
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseleave', handleMouseLeave);
        }
        
        function drawChart(data) {
            if (!ctx) return;
            
            // Clear canvas
            const container = canvas.parentElement;
            ctx.clearRect(0, 0, container.offsetWidth, container.offsetHeight);
            
            // Chart dimensions and margins
            const margin = { top: 60, right: 60, bottom: 80, left: 80 };
            const chartWidth = container.offsetWidth - margin.left - margin.right;
            const chartHeight = container.offsetHeight - margin.top - margin.bottom;
            
            // Determine which data to show based on filter
            let dataToShow = [];
            let colors = [];
            
            if (currentFilter === 'both' || currentFilter === 'arrival') {
                dataToShow.push({
                    values: data.arrivalDelay,
                    color: getComputedStyle(document.documentElement).getPropertyValue('--arrival-color').trim(),
                    type: 'arrival'
                });
            }
            
            if (currentFilter === 'both' || currentFilter === 'departure') {
                dataToShow.push({
                    values: data.departureDelay,
                    color: getComputedStyle(document.documentElement).getPropertyValue('--departure-color').trim(),
                    type: 'departure'
                });
            }
            
            // Find data range
            const allValues = dataToShow.flatMap(d => d.values);
            const minValue = Math.min(...allValues);
            const maxValue = Math.max(...allValues);
            const range = maxValue - minValue;
            const yMin = minValue - range * 0.1;
            const yMax = maxValue + range * 0.1;
            
            // Bar dimensions
            const barGroupWidth = chartWidth / hourLabels.length;
            const barWidth = currentFilter === 'both' ? 
                (barGroupWidth - 20) / 2 : // Two bars per group
                (barGroupWidth - 10); // Single bar per group
            
            // Draw title
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
            ctx.font = 'bold 18px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText('Hourly Mean Flight Delay Analysis', container.offsetWidth / 2, 30);
            
            // Draw axes
            drawAxes(margin, chartWidth, chartHeight, yMin, yMax, container.offsetWidth, container.offsetHeight);
            
            // Draw bars
            drawBars(dataToShow, margin, chartWidth, chartHeight, yMin, yMax, barGroupWidth, barWidth);
            
            // Draw labels
            drawLabels(margin, chartWidth, chartHeight, container.offsetWidth, container.offsetHeight);
        }
        
        function drawAxes(margin, chartWidth, chartHeight, yMin, yMax, canvasWidth, canvasHeight) {
            const axisColor = getComputedStyle(document.documentElement).getPropertyValue('--border-color');
            ctx.strokeStyle = axisColor;
            ctx.lineWidth = 1;
            
            // Y-axis
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top);
            ctx.lineTo(margin.left, margin.top + chartHeight);
            ctx.stroke();
            
            // X-axis
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top + chartHeight);
            ctx.lineTo(margin.left + chartWidth, margin.top + chartHeight);
            ctx.stroke();
            
            // Grid lines and labels
            drawGridLines(margin, chartWidth, chartHeight, yMin, yMax);
        }
        
        function drawGridLines(margin, chartWidth, chartHeight, yMin, yMax) {
            const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--border-color');
            const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
            
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 0.5;
            ctx.fillStyle = textColor;
            ctx.font = '12px Segoe UI';
            ctx.textAlign = 'right';
            
            // Y-axis grid lines and labels
            const ySteps = 8;
            for (let i = 0; i <= ySteps; i++) {
                const y = margin.top + (chartHeight * i / ySteps);
                const value = yMax - ((yMax - yMin) * i / ySteps);
                
                // Grid line
                ctx.beginPath();
                ctx.moveTo(margin.left, y);
                ctx.lineTo(margin.left + chartWidth, y);
                ctx.stroke();
                
                // Label
                ctx.fillText(value.toFixed(1), margin.left - 10, y + 4);
            }
            
            // X-axis labels
            ctx.textAlign = 'center';
            hourLabels.forEach((label, index) => {
                const x = margin.left + (chartWidth * (index + 0.5) / hourLabels.length);
                ctx.fillText(label, x, margin.top + chartHeight + 20);
            });
        }
        
        function drawBars(dataToShow, margin, chartWidth, chartHeight, yMin, yMax, barGroupWidth, barWidth) {
            const valueRange = yMax - yMin;
            
            hourLabels.forEach((hour, index) => {
                const groupX = margin.left + (index * barGroupWidth);
                const centerX = groupX + barGroupWidth / 2;
                
                dataToShow.forEach((dataset, dataIndex) => {
                    const value = dataset.values[index];
                    const barHeight = Math.abs((value - yMin) / valueRange * chartHeight);
                    const barY = margin.top + chartHeight - barHeight;
                    
                    let barX;
                    if (dataToShow.length === 1) {
                        // Single bar centered
                        barX = centerX - barWidth / 2;
                    } else {
                        // Multiple bars side by side
                        barX = dataIndex === 0 ? centerX - barWidth - 2 : centerX + 2;
                    }
                    
                    // Check if this bar is hovered
                    const isHovered = hoveredBar && 
                                    hoveredBar.type === dataset.type && 
                                    hoveredBar.index === index;
                    
                    // Adjust color for hover
                    ctx.fillStyle = isHovered ? 
                        adjustBrightness(dataset.color, -20) : 
                        dataset.color;
                    
                    ctx.fillRect(barX, barY, barWidth, barHeight);
                });
            });
        }
        
        function adjustBrightness(color, amount) {
            // Simple brightness adjustment for hover effect
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * amount);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }
        
        function drawLabels(margin, chartWidth, chartHeight, canvasWidth, canvasHeight) {
            const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
            ctx.fillStyle = textColor;
            ctx.font = 'bold 14px Segoe UI';
            ctx.textAlign = 'center';
            
            // X-axis label
            ctx.fillText('Hours of Day', margin.left + chartWidth / 2, canvasHeight - 20);
            
            // Y-axis label (rotated)
            ctx.save();
            ctx.translate(20, margin.top + chartHeight / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Average Delay (minutes)', 0, 0);
            ctx.restore();
        }
        
        function handleMouseMove(event) {
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            const margin = { top: 60, right: 60, bottom: 80, left: 80 };
            const chartWidth = rect.width - margin.left - margin.right;
            const chartHeight = rect.height - margin.top - margin.bottom;
            const barGroupWidth = chartWidth / hourLabels.length;
            const barWidth = currentFilter === 'both' ? 
                (barGroupWidth - 20) / 2 : 
                (barGroupWidth - 10);
            
            let newHoveredBar = null;
            
            // Check if hovering over a bar
            if (x >= margin.left && x <= margin.left + chartWidth &&
                y >= margin.top && y <= margin.top + chartHeight) {
                
                const groupIndex = Math.floor((x - margin.left) / barGroupWidth);
                if (groupIndex >= 0 && groupIndex < hourLabels.length) {
                    const groupX = margin.left + (groupIndex * barGroupWidth);
                    const centerX = groupX + barGroupWidth / 2;
                    
                    if (currentFilter === 'both') {
                        // Check arrival bar
                        if (x >= centerX - barWidth - 2 && x <= centerX - 2) {
                            newHoveredBar = { type: 'arrival', index: groupIndex };
                        }
                        // Check departure bar
                        else if (x >= centerX + 2 && x <= centerX + barWidth + 2) {
                            newHoveredBar = { type: 'departure', index: groupIndex };
                        }
                    } else {
                        // Single bar
                        const barX = centerX - barWidth / 2;
                        if (x >= barX && x <= barX + barWidth) {
                            newHoveredBar = { 
                                type: currentFilter, 
                                index: groupIndex 
                            };
                        }
                    }
                }
            }
            
            // Update hover state and tooltip
            if (JSON.stringify(newHoveredBar) !== JSON.stringify(hoveredBar)) {
                hoveredBar = newHoveredBar;
                updateTooltip(event, hoveredBar);
                drawChart(currentView === 'python' ? pythonData : rData);
            }
        }
        
        function handleMouseLeave() {
            hoveredBar = null;
            tooltip.style.opacity = '0';
            drawChart(currentView === 'python' ? pythonData : rData);
        }
        
        function updateTooltip(event, bar) {
            if (!bar) {
                tooltip.style.opacity = '0';
                return;
            }
            
            const data = currentView === 'python' ? pythonData : rData;
            const value = bar.type === 'arrival' ? data.arrivalDelay[bar.index] : data.departureDelay[bar.index];
            const delayType = bar.type === 'arrival' ? 'Arrival' : 'Departure';
            
            tooltip.innerHTML = `
                <strong>Hour ${bar.index}</strong><br>
                ${delayType} Delay: ${value.toFixed(2)} mins
            `;
            
            const rect = canvas.getBoundingClientRect();
            tooltip.style.left = (event.clientX - rect.left + 10) + 'px';
            tooltip.style.top = (event.clientY - rect.top - 10) + 'px';
            tooltip.style.opacity = '1';
        }
        
        function showPythonData() {
            if (currentView === 'python') return;
            
            currentView = 'python';
            document.getElementById('pythonBtn').classList.add('active');
            document.getElementById('rBtn').classList.remove('active');
            updateInfoText();
            drawChart(pythonData);
        }
        
        function showRData() {
            if (currentView === 'r') return;
            
            currentView = 'r';
            document.getElementById('rBtn').classList.add('active');
            document.getElementById('pythonBtn').classList.remove('active');
            updateInfoText();
            drawChart(rData);
        }

        function updateInfoText() {
            const filterText = currentFilter === 'both' ? 'Both delays' : 
                              currentFilter === 'arrival' ? 'Arrival delays only' : 'Departure delays only';
            document.getElementById('infoText').textContent = 
                `Currently showing: ${currentView === 'python' ? 'Python' : 'R'} analysis results (${filterText})`;
        }
        
        // Initialize
        window.addEventListener('load', function() {
            setupCanvas();
            drawChart(pythonData);
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (canvas) {
                setupCanvas();
                drawChart(currentView === 'python' ? pythonData : rData);
            }
        });
    </script>
</body>
</html>
