<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hourly Flight Delay Analysis</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: #ffffff;
      color: #000000;
      transition: background 0.3s, color 0.3s;
    }

    .toggle-theme {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 8px 14px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #333;
      color: #ffffff;
      font-weight: bold;
    }

    .toggle-theme.light-btn {
      background: #ffffff;
      color: #000000;
    }

    canvas {
      display: block;
      margin: auto;
    }
  </style>
</head>
<body>
  <button class="toggle-theme" id="themeBtn">üåô Dark Mode</button>

  <canvas id="myChart" width="900" height="500"></canvas>

  <script>
    let isDark = false;
    let chart;

    fetch("hourly_delay_data.json")
      .then(response => response.json())
      .then(data => {
        const ctx = document.getElementById('myChart').getContext('2d');

        chart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: data.hours,
            datasets: [
              {
                label: 'Departure Delay',
                data: data.departure,
                backgroundColor: '#17a2b8',
                hoverBackgroundColor: '#138496',
                barPercentage: 0.7,
                categoryPercentage: 0.8
              },
              {
                label: 'Arrival Delay',
                data: data.arrival,
                backgroundColor: '#dc3545',
                hoverBackgroundColor: '#a71d2a',
                barPercentage: 0.7,
                categoryPercentage: 0.8
              }
            ]
          },
          options: {
            responsive: false,
            onClick: (evt, elements) => {
              if (elements.length > 0) {
                const datasetIndex = elements[0].datasetIndex;
                chart.setDatasetVisibility(datasetIndex, !chart.isDatasetVisible(datasetIndex));
                chart.update();
              } else {
                chart.data.datasets.forEach((_, idx) => {
                  chart.setDatasetVisibility(idx, true);
                });
                chart.update();
              }
            },
            onHover: (evt, elements) => {
              evt.native.target.style.cursor = elements.length ? 'pointer' : 'default';
            },
            plugins: {
              title: {
                display: true,
                text: 'Hourly Flight Delay Analysis',
                font: { size: 20 },
                color: '#000000'
              },
              legend: {
                labels: { color: '#000000' }
              },
              tooltip: {
                enabled: true
              }
            },
            scales: {
              x: {
                title: { display: true, text: 'Hour of Day', color: '#000000' },
                ticks: { color: '#000000' },
                grid: { color: 'rgba(0,0,0,0.1)' }
              },
              y: {
                title: { display: true, text: 'Average Delay (minutes)', color: '#000000' },
                ticks: { color: '#000000' },
                grid: { color: 'rgba(0,0,0,0.1)' }
              }
            },
            interaction: {
              mode: 'nearest',
              axis: 'x',
              intersect: true
            }
          }
        });
      });

    document.getElementById('themeBtn').addEventListener('click', () => {
      if (!chart) return;

      isDark = !isDark;

      if (isDark) {
        document.body.style.background = '#1a1a1a';
        document.body.style.color = '#ffffff';
        chart.options.plugins.title.color = '#ffffff';
        chart.options.plugins.legend.labels.color = '#ffffff';
        chart.options.scales.x.ticks.color = '#ffffff';
        chart.options.scales.y.ticks.color = '#ffffff';
        chart.options.scales.x.title.color = '#ffffff';
        chart.options.scales.y.title.color = '#ffffff';
        chart.options.scales.x.grid.color = 'rgba(255,255,255,0.2)';
        chart.options.scales.y.grid.color = 'rgba(255,255,255,0.2)';

        chart.data.datasets[0].backgroundColor = '#4fc3f7';
        chart.data.datasets[0].hoverBackgroundColor = '#039be5';
        chart.data.datasets[1].backgroundColor = '#fbc02d';
        chart.data.datasets[1].hoverBackgroundColor = '#f57f17';

        document.getElementById('themeBtn').textContent = '‚òÄÔ∏è Light Mode';
        document.getElementById('themeBtn').classList.add('light-btn');
      } else {
        document.body.style.background = '#ffffff';
        document.body.style.color = '#000000';
        chart.options.plugins.title.color = '#000000';
        chart.options.plugins.legend.labels.color = '#000000';
        chart.options.scales.x.ticks.color = '#000000';
        chart.options.scales.y.ticks.color = '#000000';
        chart.options.scales.x.title.color = '#000000';
        chart.options.scales.y.title.color = '#000000';
        chart.options.scales.x.grid.color = 'rgba(0,0,0,0.1)';
        chart.options.scales.y.grid.color = 'rgba(0,0,0,0.1)';

        chart.data.datasets[0].backgroundColor = '#17a2b8';
        chart.data.datasets[0].hoverBackgroundColor = '#138496';
        chart.data.datasets[1].backgroundColor = '#dc3545';
        chart.data.datasets[1].hoverBackgroundColor = '#a71d2a';

        document.getElementById('themeBtn').textContent = 'üåô Dark Mode';
        document.getElementById('themeBtn').classList.remove('light-btn');
      }

      chart.update();
    });
  </script>
</body>
</html>